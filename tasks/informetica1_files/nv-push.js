this.nvpack=this.nvpack||{},this.nvpack.push=function(){"use strict";var i,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},t=function(i,n){if(!(i instanceof n))throw new TypeError("Cannot call a class as a function")},e=function(){function i(i,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(n,t,e){return t&&i(n.prototype,t),e&&i(n,e),n}}(),o=function(){function i(){t(this,i),this.document=window.document,this.browserStatus={isSafari:0,isChrome:0,isFirefox:0,isIE:0,isSafariPush:0,isChromePush:0,isFirefoxPush:0},this.isIncognito=0}return e(i,[{key:"getMobileStatus",value:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?1:0}},{key:"getBrowser",value:function(){var i=void 0,n=window.navigator.userAgent;if(document.documentMode||/Edge/.test(navigator.userAgent))this.browserStatus.isIE=1;else if(/chrome/i.test(n))this.browserStatus.isChrome=1,i=/Android|webOS/i.test(navigator.userAgent)?n.split("/")[n.split("/").length-2]:n.split(" ")[n.split(" ").length-2].substr(7),this.browserStatus.isChromePush=i.substring(0,2)>=42?1:0;else if(n.indexOf("Safari")>0&&-1==n.indexOf("Chrome"))this.browserStatus.isSafari=1,i=n.substring(0,n.indexOf("Safari")).substring(n.substring(0,n.indexOf("Safari")).lastIndexOf("/")+1),this.browserStatus.isSafariPush=parseInt(i,10)>=7?1:0;else if(/firefox/i.test(n)){this.browserStatus.isFirefox=1;var t=n.indexOf("Firefox"),e=n.substring(t+8),o=parseInt(""+e,10);o=isNaN(o)?parseInt(navigator.appVersion,10):o,this.browserStatus.isFirefoxPush=o>=44&&!/Android|webOS/i.test(navigator.userAgent)||o>=48&&/Android|webOS/i.test(navigator.userAgent)?1:0}return this.browserStatus}},{key:"checkIncognito",value:function(){var i=this;return new Promise(function(n,t){i.isIncognito=0;var e,o,s,r,u,a=i,c=window.navigator.userAgent;if(/chrome/i.test(c)){var h=window.RequestFileSystem||window.webkitRequestFileSystem;h?h(window.TEMPORARY,100,function(){return n(!1)},function(){a.isIncognito=1,n(!0)}):(a.isIncognito=1,n(!0))}else if(/firefox/i.test(c)){if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var v=void 0,f=void 0;try{(v=window.indexedDB.open("test")).onerror=function(){return!0}}catch(i){f=!0,a.isIncognito=1,n(!0)}void 0===f&&(e=function(){return"done"===v.readyState},o=function(i){i||(!0===(f=!v.result)?(a.isIncognito=1,n(!0)):n(!1))},s=0,r=!1,u=window.setInterval(function(){e()&&(window.clearInterval(u),o(r)),s++>50&&(window.clearInterval(u),o(r=!0))},10))}}setTimeout(function(){n(!1)},1e3)})}},{key:"getQueryValue",value:function(i){for(var n=window.location.search.substring(1).split("&"),t=0;t<n.length;t++){var e=n[t].split("=");if(e[0]==i)return e[1]}}}]),i}(),s=function(){function i(){t(this,i),this.document=window.document}return e(i,[{key:"set",value:function(i,n,t,e){var o=new Date((new Date).setHours(23,59,59,0));t=t||0==t?"expires="+t:"expires="+o,e=e?"domain=."+e:"",document.cookie=i+"="+n+"; "+t+"; "+e+"; path=/"}},{key:"get",value:function(i){for(var n=i+"=",t=document.cookie.split(";"),e=0;e<t.length;e++){var o=t[e].trim();if(0==o.indexOf(n))return o.substring(n.length,o.length)}return null}},{key:"remove",value:function(i){document.cookie=i+"=; Max-Age=-99999999;"}},{key:"setLS",value:function(i,n){return localStorage.setItem(i,n)}},{key:"getLS",value:function(i){return localStorage.getItem(i)}},{key:"duration",value:function(i){var n=1,t="Fri, 31 Dec 1999 23:59:59 GMT";if(i)if(501==i)t="Fri, 31 Dec 1999 23:59:59 GMT";else if(0==i)t=0;else{500==i?n=365:i>0&&i<=90&&(n=i);var e=new Date;1!=n&&(n-=1,e.setTime(e.getTime()+24*n*60*60*1e3)),e.setHours(23,59,59,0),t=e}return t}}]),i}(),r=function(){function i(n){t(this,i),this.scope=n,this.document=window.document}return e(i,[{key:"pushHandler",value:function(){var i=this;if(i.scope.config.pushDetails){var n=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(1!=i.scope.browserController.isIncognito&&!n&&(i.scope.browserController.browserStatus.isChromePush&&1==i.scope.config.pushDetails.chrome||i.scope.browserController.browserStatus.isFirefoxPush&&1==i.scope.config.pushDetails.mozilla||i.scope.browserController.browserStatus.isSafariPush&&1==i.scope.config.pushDetails.safari)){i.scope.config.pushDetails.allow_window&&document.getElementById("nv-push-custom-html")&&(document.getElementById("nv-push-custom-html").innerHTML=i.scope.response.pushDetails.allow_window);var t=i.scope.cookieController.get("nv_push_subscribe");t||(t=void 0!=i.scope.config.pushDetails.subscriber?i.scope.config.pushDetails.subscriber:t),"https:"==document.location.protocol&&t?i.scope.cookieController.get("nv_push_domain")&&i.scope.cookieController.get("nv_push_domain")==document.location.hostname&&!i.scope.browserController.browserStatus.isSafariPush&&"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(n){n.pushManager.getSubscription().then(function(n){try{if(!n)throw"1";if(i.scope.browserController.browserStatus.isFirefox){if(n.endpoint!=t)throw"1"}else if(n.endpoint.split("/").pop()!=t)throw"1"}catch(n){"1"==n&&(t="",i.subscription())}})}):t||i.subscription(),t&&(i.scope.pushLeaveIntentController.initialize(t),i.scope.config.pushSubscriber=t,i.scope.geofenceController.location())}1==i.scope.config.pushDetails.location_perm&&i.scope.geofenceController.ask(),i.scope.config.pushDetails.chicklet&&0!=i.scope.config.pushDetails.chicklet&&(i.scope.notificationCenterController.chickLet(i.scope.config.pushDetails,i.scope.notificationCenterController.notificationCenter),i.scope.notificationCenterController.notificationCenter())}(void 0!=i.scope.config.pushDetails&&1==i.scope.config.pushDetails.hosted&&i.scope.browserController.browserStatus.isChromePush&&1==i.scope.config.pushDetails.chrome||i.scope.browserController.browserStatus.isFirefoxPush&&1==i.scope.config.pushDetails.mozilla||void 0!=i.scope.config.addToHomeSetting&&1==i.scope.config.addToHomeSetting.allow)&&i.scope.serviceWorkerController.registerSw()}},{key:"subscription",value:function(){var i=this;i.scope.cookieController.get("nv_push_error")&&"200"!=i.scope.cookieController.get("nv_push_error")||(i.scope.cookieController.get("nv_push_neg")||i.scope.cookieController.get("nv_push_pos")||i.scope.config.pushDetails.perm_times>0&&i.scope.cookieController.get("nv_push_times")&&i.scope.cookieController.get("nv_push_times")>=i.scope.config.pushDetails.perm_times?i.scope.config.showChicklet=1:setTimeout(function(){i.askPermission()},1e3*i.scope.config.pushDetails.perm_delay))}},{key:"askPermission",value:function(){var i=this;if(1==i.scope.config.pushDetails.hosted&&"https:"==document.location.protocol){if("serviceWorker"in navigator&&!i.scope.browserController.browserStatus.isSafariPush){if(!("showNotification"in ServiceWorkerRegistration.prototype))return console.log("Notifications aren't supported."),void i.scope.handlepushSubscription("102");if(!("PushManager"in window))return console.log("Push messaging isn't supported."),void i.scope.handlepushSubscription("103");if("denied"===Notification.permission)return console.log("The user has blocked notifications."),void i.scope.handlepushSubscription("201")}"0"==i.scope.config.pushDetails.desktop_ui&&1!==i.scope.browserController.getMobileStatus()||"0"==i.scope.config.pushDetails.mobile_ui&&"1"==i.scope.browserController.getMobileStatus()?i.httpsPermission():i.scope.widgetContoller.customPermBox(i.scope.config.pushDetails)}else i.scope.widgetContoller.customPermBox(i.scope.config.pushDetails)}},{key:"httpsPermission",value:function(){var i=this;i.scope.config.subscribe=i.scope.config.subscribe||{},i.scope.config.subscribe=i.scope.data.auth,i.scope.config.pushSubscribe&&i.scope.config.pushSubscribe.userID&&(i.scope.config.subscribe.userID=i.scope.config.pushSubscribe.userID);var n=i.scope.browserController.getQueryValue("nv_url");i.scope.config.subscribe.pageUrl=n||i.scope.data.setting.pageUrl,i.scope.browserController.browserStatus.isChromePush||i.scope.browserController.browserStatus.isFirefoxPush?i.scope.serviceWorkerController.launch(i.scope.config):i.scope.browserController.browserStatus.isSafariPush&&window.location.href.includes(i.scope.config.pushDetails.safari_website)&&i.scope.safariWorkerController.launch(i.scope.config.pushDetails)}}]),i}(),u=function(){function i(n){t(this,i),this.scope=n,this.document=window.document}return e(i,[{key:"launch",value:function(i){var n=this;if("serviceWorker"in navigator){var t=void 0!=i.pushDetails&&i.pushDetails.sw_path?i.pushDetails.sw_path:i.addToHomeSetting&&i.addToHomeSetting.sw_path?i.addToHomeSetting.sw_path:"/service-worker.js",e=n.scope.config.addToHomeSetting.webapp_version,o=e?"?nvhash="+e:"";navigator.serviceWorker.register(t+o).then(function(i){n.askPushPermission()},function(i){console.log("Service worker registration failed:",i)})}else console.log("Service workers aren't supported in this browser."),n.scope.handlepushSubscription("101")}},{key:"initializeState",value:function(){var i=this;navigator.serviceWorker.ready.then(function(n){n.pushManager.getSubscription().then(function(n){n?i.sendToServer(n):i.subscribe()}).catch(function(n){console.log("Error during getSubscription()",n),i.scope.handlepushSubscription("104")})})}},{key:"askPushPermission",value:function(){var i=this;return new Promise(function(n,t){var e=Notification.requestPermission(function(i){n(i)});if(e){var o=i.scope.cookieController.get("nvpush_overlay");i.scope.config.pushDetails.allow_bg&&"1"!==o&&"granted"!==Notification.permission&&function(i){if(i.config.nativeBackground_done=0,document.getElementById("nvpush_popup_background"))document.getElementById("nvpush_popup_background").style.display="block";else{var n=0;if(1==i.browserController.browserStatus.isChromePush&&((n=sessionStorage.getItem("nv_push_background"))||sessionStorage.setItem("nv_push_background","1")),1!=n){var t=document.createElement("div");if(t.id="nvpush_popup_background",t.innerHTML=i.config.pushDetails.iframe_popup_background.iframe_outer,document.body.appendChild(t),document.getElementById("nvpush_cross")&&document.getElementById("nvpush_cross").addEventListener("click",function(){document.getElementById("nvpush_popup_background").style.display="none",i.cookieController.set("nvpush_overlay",1)}),document.getElementById("nvpush_popup_background_iframe")){var e=document.getElementById("nvpush_popup_background_iframe").contentWindow.document;e.open(),e.write(i.config.pushDetails.iframe_popup_background.iframe),e.close()}}}}(i.scope),e.then(n,t)}}).then(function(n){return document.getElementById("nvpush_popup_background")&&(i.scope.config.nativeBackgroundDone=1,document.getElementById("nvpush_popup_background").style.display="none"),"denied"===Notification.permission?(console.log("The user has blocked notifications."),i.scope.browserController.browserStatus.isFirefox?i.scope.sendStats("mozilla_denied"):i.scope.sendStats("chrome_denied"),void i.scope.handlepushSubscription("201")):"default"===Notification.permission?(console.log("Permission box closed"),void(i.scope.browserController.browserStatus.isFirefox||(i.scope.sendStats("chrome_closed"),i.scope.handlepushSubscription("202")))):void i.initializeState()})}},{key:"subscribe",value:function(){var i=this;navigator.serviceWorker.ready.then(function(n){var t={userVisibleOnly:!0},e="0";i.scope.config.pushDetails.vapid_public&&(e="1",t.applicationServerKey=i.urlBase64ToUint8Array(i.scope.config.pushDetails.vapid_public)),n.pushManager.subscribe(t).then(function(n){return document.getElementById("nvpush_popup_background_loader")&&(document.getElementById("nvpush_popup_background_loader").style.display="block"),document.getElementById("nvpush_popup_background")&&(i.scope.config.nativeBackgroundDone=1,document.getElementById("nvpush_popup_background").style.display="none"),i.scope.browserController.browserStatus.isFirefox?i.scope.gapush.send("mozilla_allow"):i.scope.gapush.send("chrome_allow"),n.vapid=e,i.sendToServer(n)}).catch(function(i){console.log(i)})})}},{key:"sendToServer",value:function(i){var n=this;if(!i.endpoint)return console.log("This browser isn't currently supported for this demo"),void this.scope.handlepushSubscription("105");var t=JSON.parse(JSON.stringify(i));if(t.keys&&(t.keys.p256dh&&(n.scope.config.subscribe.pkey=n.scope.data.setting.pkey=t.keys.p256dh),t.keys.auth&&(n.scope.config.subscribe.authkey=n.scope.data.setting.authkey=t.keys.auth)),i.vapid&&(n.scope.config.subscribe.vapid=i.vapid),n.scope.browserController.browserStatus.isFirefox)console.log("mozilla endpoint",i.endpoint),n.scope.config.subscribe.endpoint=i.endpoint,n.scope.getJSONP.get(n.scope.config.urls.mozilla_subscribe,n.scope.config.subscribe,n.scope.callbackName,n.mozillaHandleResponse.bind(this));else{if(-1==i.endpoint.indexOf("googleapis.com/gcm/send")&&-1==i.endpoint.indexOf("googleapis.com/fcm/send"))return console.log("This browser isn't currently supported"),void n.scope.handlepushSubscription("105");var e=i.subscriptionId?i.subscriptionId:i.endpoint.split("/").pop();console.log("server subscription id",e),n.scope.config.subscribe.subscriptionId=n.scope.data.setting.subscriptionId=e,n.scope.getJSONP.get(n.scope.config.urls.chrome_subscribe,n.scope.config.subscribe,n.scope.callbackName,n.chromeHandleResponse.bind(n))}}},{key:"chromeHandleResponse",value:function(i){if(i.subscriber){this.scope.handlepushSubscription("200",i.subscriber);this.scope.cookieController.set("nv_push_domain",document.location.hostname,"Fri, 31 Dec 9999 23:59:59 GMT")}}},{key:"mozillaHandleResponse",value:function(i){if(i.subscriber){this.scope.handlepushSubscription("200",i.subscriber);var n=new Date;n.setTime(n.getTime()+1728e6);var t=n.toGMTString();this.scope.cookieController.set("nv_push_domain",document.location.hostname,t)}}},{key:"registerSw",value:function(){var i=this;if("https:"==document.location.protocol&&(i.scope.browserController.browserStatus.isChromePush||i.scope.browserController.browserStatus.isFirefoxPush)&&"serviceWorker"in navigator){var n=void 0!=i.scope.config.pushDetails&&i.scope.config.pushDetails.sw_path?i.scope.config.pushDetails.sw_path:i.scope.config.addToHomeSetting&&i.scope.config.addToHomeSetting.sw_path?i.scope.config.addToHomeSetting.sw_path:"/service-worker.js",t=i.scope.config.addToHomeSetting.webapp_version,e=t?"?nvhash="+t:"";navigator.serviceWorker.register(n+e),"granted"!==Notification.permission&&void 0!=i.scope.config.pushDetails&&"1"==i.scope.config.pushDetails.hosted&&i.unSubscribe()}}},{key:"unSubscribe",value:function(){if(this.scope.config.pushSubscriber){this.scope.cookieController.set("nv_push_error",0,"Fri, 31 Dec 1999 23:59:59 GMT"),this.scope.cookieController.set("nv_push_subscribe",0,"Fri, 31 Dec 1999 23:59:59 GMT"),this.scope.config.unSubscribe={},this.scope.config.unSubscribe=this.scope.data.auth,this.scope.config.unSubscribe.subscriptionID=this.scope.config.pushSubscriber,this.scope.config.pushSubscriber="";var i=this.scope.config.urls.push_unsub;this.scope.browserController.browserStatus.isFirefox&&(i=this.scope.config.urls.push_unsub_moz),this.scope.getJSONP.get(i,this.scope.config.unSubscribe,this.scope.callbackName,this.unsubscribeResponse.bind(this))}}},{key:"urlBase64ToUint8Array",value:function(i){var n=(i+"=".repeat((4-i.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(n);return Uint8Array.from([].concat(function(i){if(Array.isArray(i)){for(var n=0,t=Array(i.length);n<i.length;n++)t[n]=i[n];return t}return Array.from(i)}(t)).map(function(i){return i.charCodeAt(0)}))}},{key:"unsubscribeResponse",value:function(i){}}]),i}(),a=function(){function i(n){t(this,i),this.scope=n,this.document=window.document}return e(i,[{key:"launch",value:function(i){i.safari_push_id=i.safari_push_id?i.safari_push_id:"web.com.notifyvisitors";var n=window.safari.pushNotification.permission(i.safari_push_id);switch(n.permission){case"default":this.requestPermissions(i);break;case"granted":this.sendToServer(n.deviceToken);break;case"denied":console.log("Permission for Notifications was denied")}}},{key:"requestPermissions",value:function(i){var n=this;i.safari_push_id=i.safari_push_id?i.safari_push_id:"web.com.notifyvisitors",window.safari.pushNotification.requestPermission("https://push.notifyvisitors.com/safari/hosted",i.safari_push_id,{id:n.scope.data.auth.bid},function(i){switch(i.permission){case"granted":n.sendToServer(i.deviceToken),n.scope.gapush.send("safari_allow");break;case"denied":n.scope.sendStats("safari_denied"),n.scope.handlepushSubscription("201")}})}},{key:"sendToServer",value:function(i){this.scope.config.subscribe.subscriptionId=i,this.scope.getJSONP.get(this.scope.config.urls.safari_subscribe,this.scope.config.subscribe,this.scope.callbackName,this.handleResponse.bind(this))}},{key:"handleResponse",value:function(i){i.subscriber&&this.scope.handlepushSubscription("200",i.subscriber)}}]),i}(),c=function(){function i(n){t(this,i),this.scope=n,this.document=window.document}return e(i,[{key:"customPermBox",value:function(i){var n=document.createElement("div");n.innerHTML="1"==this.scope.browserController.getMobileStatus()?i.perm_box_view.mobile:i.perm_box_view.desktop,n.id="notify-visitors-push-confirm-popup",document.body.firstChild?document.body.insertBefore(n,document.body.firstChild):document.body.appendChild(n),this.pushConfirmInitialize(i),this.scope.gapush.send("NotifyVisitors","Push_Stats","CustomPermissionBox_shown")}},{key:"pushConfirmInitialize",value:function(i){var n=this,t=document.getElementById("notify-visitors-confirm-popup-btn-positive");n.scope.bindEvent.bind(t,"click",function(){return document.getElementById("notify-visitors-push-confirm-popup")&&(document.getElementById("notify-visitors-push-confirm-popup").style.display="none"),n.pushConfirmPositive()});var e=document.getElementById("notify-visitors-confirm-popup-btn-negative");n.scope.bindEvent.bind(e,"click",function(){return document.getElementById("notify-visitors-push-confirm-popup")&&(document.getElementById("notify-visitors-push-confirm-popup").style.display="none"),n.pushConfirmNegative()})}},{key:"pushConfirmPositive",value:function(){this.scope.gapush.send("NotifyVisitors","Push_Stats","CustomPermissionBox_allow"),1==this.scope.config.pushDetails.hosted&&"https:"==document.location.protocol?this.scope.pushHandlerController.httpsPermission():this.pushAllowWindow()}},{key:"pushAllowWindow",value:function(){var i=Number(screen.width/2-300),n=Number(screen.height/2-300),t="";1==this.scope.config.pushDetails.hosted?(t=this.scope.config.pushDetails.hosted_link,t+=-1===t.indexOf("?")?"?":"&",t=-1!==(t+="nv_url="+encodeURIComponent(this.scope.data.setting.pageUrl)).indexOf("notifyvisitors_push/chrome/custom.html")?t+"&bid="+this.scope.data.auth.bid+"&bid_e="+this.scope.data.auth.bid_e+"&t="+this.scope.data.auth.t:t):(t=this.scope.config.urls.permissionBox+"?bid="+this.scope.data.auth.bid+"&bid_e="+this.scope.data.auth.bid_e+"&t="+this.scope.data.auth.t,this.scope.config.pushSubscribe&&this.scope.config.pushSubscribe.userID&&(t+="&userID="+this.scope.config.pushSubscribe.userID),t+="&pageUrl="+this.scope.data.setting.pageUrl),window.open(t,"_blank","width=500, height=500,top="+n+", left="+i)}},{key:"pushConfirmNegative",value:function(){this.scope.cookieController.set("nv_push_neg",1);var i=this.scope.cookieController.get("nv_push_times");i=(i=parseInt(i))?i+1:1;var n=new Date;n.setTime(n.getTime()+2592e6);var t=n.toGMTString();this.scope.cookieController.set("nv_push_times",i,t),this.scope.gapush.send("NotifyVisitors","Push_Stats","CustomPermissionBox_denied")}}]),i}(),h=function(){function i(n){t(this,i),this.scope=n,this.document=window.document}return e(i,[{key:"chickLet",value:function(i,n){if(1==i.chicklet){var t=document.getElementById("notify-visitors-push-chicklet");t&&t.parentNode.removeChild(t);var e=document.createElement("style");e.innerHTML=i.chicklet_view.style,document.head.appendChild(e);var o=document.createElement("div");o.innerHTML=screen.width>600?i.chicklet_view.desktop:i.chicklet_view.mobile,setTimeout(function(){document.getElementById("nv-hover_text").className="nv-text-point nv-chicklet_none"},5e3),o.id="notify-visitors-push-chicklet",o.onclick=n.bind(this),document.body.firstChild?document.body.insertBefore(o,document.body.firstChild):document.body.appendChild(o)}}},{key:"notificationCenter",value:function(){var i=this,n=document.getElementById("nv_notification_center_button");if("2"==i.scope.config.pushDetails.chicklet||"3"==i.scope.config.pushDetails.chicklet){var t=document.querySelectorAll("[id='"+i.scope.config.pushDetails.chicklet_onclick_id+"']");if(t.length>=2){for(var e=0;e<t.length;e++)if(0!==t[e].offsetWidth&&0!==t[e].offsetHeight){n=t[e];break}}else n=document.getElementById(i.scope.config.pushDetails.chicklet_onclick_id)}if(n){i.scope.config.pushDetails.notification_center_count_css&&i.ncCounter(i.scope.config.pushDetails,n);var o=document.createElement("div");if(o.id="notification_center_iframe_parent_div",n.appendChild(o),"3"==this.scope.config.pushDetails.chicklet&&1!==this.scope.browserController.getMobileStatus()){n.onmouseover=function(){i.ncHideCounter(),i.nvCenterData()};var s=document.getElementById("notification_center_iframe_parent_div");s&&(n.onmouseleave=function(){s.onmouseover?s.onmouseout=function(){s.style.display="none"}:s.style.display="none"})}else n.onclick=function(){i.ncHideCounter(),1===i.scope.browserController.getMobileStatus()?i.mobNvCenterData():i.nvCenterData()}}}},{key:"mobNvCenterData",value:function(){var i=this;if(document.getElementById("nvpush_nvcenter_mobileiframe_parent"))i.mobNvCenterVisibility();else{var n=document.createElement("div");if(n.innerHTML=i.scope.config.pushDetails.notification_center_iframe.iframe,document.body.appendChild(n),document.getElementById("nvpush_notification_center_mobile_iframe")){if(void 0!=i.scope.config.pushDetails.notification_center_iframe.resize&&"1"===i.scope.config.pushDetails.notification_center_iframe.resize){var t=document.getElementById("nvpush_notification_center_mobile_iframe").scrollHeight;t<=300&&(t+=75,document.getElementById("nvpush_nvcenter_mobileiframe_parent").style.height=t+"px")}var e=document.getElementById("nvpush_notification_center_mobile_iframe").contentWindow.document;e.open(),e.write(i.scope.config.pushDetails.notification_center_iframe_svg),e.close()}setTimeout(function(){i.centerJsonpCall(i,!0)},1)}}},{key:"mobNvCenterResponse",value:function(i){if(document.getElementById("nvpush_notification_center_mobile_iframe")){var n=document.getElementById("nvpush_notification_center_mobile_iframe").contentWindow.document;n.open(),n.write(i.view),n.close()}}},{key:"mobNvCenterVisibility",value:function(){var i=document.getElementById("nvpush_nvcenter_mobileiframe_parent");i&&(i.style.display="block"===i.style.display?"none":"block")}},{key:"nvCenterData",value:function(i){var n=this;if(document.getElementById("nvpush_notification_center_iframe"))"3"==n.scope.config.pushDetails.chicklet&&1!==n.scope.browserController.getMobileStatus()?document.getElementById("notification_center_iframe_parent_div").style.display="block":n.nvCenterVisibility();else{if(document.getElementById("notification_center_iframe_parent_div").innerHTML=this.scope.config.pushDetails.notification_center_iframe.iframe,document.getElementById("nvpush_notification_center_iframe")){var t=document.getElementById("nvpush_notification_center_iframe").contentWindow.document;t.open(),t.write(n.scope.config.pushDetails.notification_center_iframe_svg),t.close()}setTimeout(function(){n.centerJsonpCall(n,!1)},1)}}},{key:"nvCenterResponse",value:function(i){if(document.getElementById("nvpush_notification_center_iframe")){var n=document.getElementById("nvpush_notification_center_iframe").contentWindow.document;n.open(),n.write(i.view),n.close()}}},{key:"nvCenterVisibility",value:function(){var i=document.getElementById("nvpush_notification_center_iframe");"visible"===i.style.visibility?(i.style.visibility="hidden",document.getElementById("notification_center_iframe_parent_div").style.display="none",document.getElementById("nv-pick").style.visibility="hidden"):(i.style.visibility="visible",document.getElementById("notification_center_iframe_parent_div").style.display="block",document.getElementById("nv-pick").style.visibility="visible")}},{key:"centerJsonpCall",value:function(i,n){i.scope.config.pushCenter={},i.scope.config.pushCenter=i.scope.data.auth,void 0!=i.scope.config.pushSubscriber&&(i.scope.config.pushCenter.subscriptionID=i.scope.config.pushSubscriber),void 0!=i.scope.config.showChicklet&&(i.scope.config.pushCenter.showChicklet=i.scope.config.showChicklet),i.scope.getJSONP.get(i.scope.config.urls.push_center,i.scope.config.pushCenter,i.scope.callbackName,n?i.mobNvCenterResponse:i.nvCenterResponse.bind(this))}},{key:"ncCounter",value:function(i,n){var t=this.scope.cookieController.getLS("nv_center_count_date");!t&&(t="1970-01-01 00:00:00");var e=i.notification_center_count,o=0;if(e.length)for(var s=0;s<e.length;s++)e[s]>t&&o++;if(o>0){var r=document.createElement("div"),u=i.notification_center_count_css;r.id="_nv-notification-count",r.innerHTML='<div class="_nv-notification-inner-count">'+o+"</div>"+u,n.appendChild(r)}}},{key:"ncHideCounter",value:function(){var i=this.ncCounterDateFormat();this.scope.cookieController.setLS("nv_center_count_date",i);var n=document.getElementById("_nv-notification-count");n&&(n.style.display="none")}},{key:"ncCounterDateFormat",value:function(){var i=new Date;return i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()+" "+(i.getHours()+":"+i.getMinutes()+":"+i.getSeconds())}}]),i}(),v=function(){function i(n){t(this,i),this.scope=n,this.askError=this.askError.bind(this)}return e(i,[{key:"location",value:function(){var i=this;navigator.geolocation&&navigator.permissions.query({name:"geolocation"}).then(function(n){"granted"==n.state&&navigator.geolocation.getCurrentPosition(function(n){var t=(new Date).toJSON().slice(0,10).replace(/-/g,"/");if(!i.scope.cookieController.getLS("nvpush_geofence")||i.scope.cookieController.getLS("nvpush_geofence")!=t){i.scope.config.geofencing=i.scope.data.auth,i.scope.config.geofencing.latitude=n.coords.latitude,i.scope.config.geofencing.longitude=n.coords.longitude,i.scope.config.geofencing.subscriptionID=i.scope.config.pushSubscriber,1==i.scope.browserController.browserStatus.isChrome?i.scope.config.geofencing.platform="1":1==i.scope.browserController.browserStatus.isFirefox?i.scope.config.geofencing.platform="2":1==i.scope.browserController.browserStatus.isSafari&&(i.scope.config.geofencing.platform="5");var e=0;if(i.scope.cookieController.getLS("nvpush_geo_coord")){var o=JSON.parse(i.scope.cookieController.getLS("nvpush_geo_coord")),s=o.coords.lat;o.coords.long.toPrecision(6)!=n.coords.longitude.toPrecision(6)&&s.toPrecision(6)!=n.coords.latitude.toPrecision(6)&&t!=o.timestamp&&(e=1)}else e=1;if(1==e){var r={coords:{lat:n.coords.latitude,long:n.coords.longitude},timestamp:t};i.scope.cookieController.setLS("nvpush_geo_coord",JSON.stringify(r)),i.scope.getJSONP.get(i.scope.config.urls.geofencing,i.scope.config.geofencing,i.scope.callbackName,i.handleGeoResponse.bind(i))}}})})}},{key:"handleGeoResponse",value:function(i){i.geofence&&1!==i.geofence&&this.scope.cookieController.setLS("nvpush_geofence",(new Date).toJSON().slice(0,10).replace(/-/g,"/"))}},{key:"ask",value:function(){this.scope.cookieController.get("nv_geo_neg")||navigator.geolocation.getCurrentPosition(this.askSuccess,this.askError)}},{key:"askSuccess",value:function(){console.log("geo access")}},{key:"askError",value:function(){this.scope.cookieController.setLS("nv_geo_neg",1),console.log("geo denied")}}]),i}(),f=function(){function i(n){t(this,i),this.scope=n}return e(i,[{key:"initialize",value:function(i){var n=this;if(n.scope.response&&n.scope.response.notification){var t={};return(t=n.scope.data.auth).notificationID=n.scope.response.notification.notificationID,t.time=parseInt(n.scope.response.notification.leaveIntent_time&&0!=n.scope.response.notification.leaveIntent_time?60*n.scope.response.notification.leaveIntent_time:60),t.subscriptionID=i,n.scope.browserController.browserStatus.isChrome?t.platform=1:n.scope.browserController.browserStatus.isFirefox?t.platform=2:n.scope.browserController.browserStatus.isSafari&&(t.platform=5),void n.leaveIntentCall(t)}}},{key:"leaveIntentCall",value:function(i){var n=this;return n.scope.bindEvent.bind(document,"mouseout",function(t){var e=(t=t||window.event).relatedTarget||t.toElement;e&&"HTML"!=e.nodeName||t.pageY-window.pageYOffset<=1&&(parseInt(n.scope.cookieController.get("_nv_push_li_"+i.notificationID))||(n.scope.cookieController.set("_nv_push_li_"+i.notificationID,i.notificationID),n.scope.getJSONP.get(n.scope.config.urls.schedule_push,i,"push_leave_intent",n.leaveIntentResponse.bind(this))))}),this}},{key:"leaveIntentResponse",value:function(i){}}]),i}(),d=function(){var i=window.document,n=0,t=void 0,e=void 0;return{get:function(o,s,r,u){var a=-1!==o.indexOf("?")?"&":"?";s=s||{};for(e in s)s.hasOwnProperty(e)&&(a+=encodeURIComponent(e)+"="+encodeURIComponent(s[e])+"&");var c,h,v,f=r+ ++n;return window[f]=function(i){u(i);try{delete window[f]}catch(i){}window[f]=null},c=o+a+"js_callback="+f,h=i.createElement("script"),v=!1,h.src=c,h.async=!0,h.onload=h.onreadystatechange=function(){v||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(v=!0,h.onload=h.onreadystatechange=null,h&&h.parentNode&&h.parentNode.removeChild(h))},!t&&(t=i.getElementsByTagName("head")[0]),t.appendChild(h),f},post:function(i,n,t,e,o){o.ajax({url:i,type:"POST",data:n,contentType:!1,processData:!1,success:e})}}},l=function(){return{bind:function(i,n,t){return i.addEventListener?i.addEventListener(n,t):i.attachEvent?i.attachEvent("on"+n,t):void 0},unbind:function(i,n,t){return i.removeEventListener?i.removeEventListener(n,t):i.detachEvent?i.detachEvent("on"+n,t):void 0}}},p=function(){return{send:function(i,n,t){"function"==typeof ga&&ga("send","event",i,n,t,1,{nonInteraction:!0}),"function"==typeof cmCreateElementTag&&cmCreateElementTag(n,i,t)}}},_="https://push.notifyvisitors.com/",m="https://push.notifyvisitors.com/",w={permissionBox:m+"brand/t1/permissionBox",schedule_push:_+"brand/t1/schedule",chrome_subscribe:_+"brand/t1/chrome_subscribe",safari_subscribe:_+"brand/t1/safari_subscribe",mozilla_subscribe:_+"brand/t1/mozilla_subscribe",native_thanks:m+"brand/t1/thanksWindow",push_stats:m+"brand/t1/stats",push_unsub:m+"brand/t1/unsubscribe",push_unsub_moz:m+"brand/t1/unsubscribe_mozilla",push_center:m+"brand/t1/notifications",geofencing:m+"brand/t1/geofencing"},b=new Date,k=function(){function _(i){t(this,_),this.response={},this.config=this.config||{},this.data=this.data||{},this.config.pushSubscribe=this.config.pushSubscribe||{},this.getJSONP=d(),this.bindEvent=l(),this.gapush=p(),this.callbackName="nvpush_json",this.cookieController=new s,this.browserController=new o,this.pushHandlerController=new r(this),this.serviceWorkerController=new u(this),this.safariWorkerController=new a(this),this.widgetContoller=new c(this),this.notificationCenterController=new h(this),this.geofenceController=new v(this),this.pushLeaveIntentController=new f(this),this.addToHomeBtnClickHandler=this.addToHomeBtnClickHandler.bind(this),this.beforeInstallPromptHandler=this.beforeInstallPromptHandler.bind(this),this.beforeInstallPromptHandlerDiffer=this.beforeInstallPromptHandlerDiffer.bind(this),this.beforeInstallPromptEvent=null,this.addToHomeBtn,this.webappShown=0,this.addToHSsession=this.addToHSsession.bind(this),this.webappSession=0,this.checkAuth(i)}return e(_,[{key:"checkAuth",value:function(i){this.response=i,void 0!=i.auth&&this.browserController.checkIncognito().then(function(){void 0!=i.async&&!1!==i.async?handleWindowLoad():this.init()}.bind(this))}},{key:"handleWindowLoad",value:function(){"complete"==document.readyState?this.init():window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent&&window.attachEvent("onload",init)}},{key:"init",value:function(){if(nvpack.config=nvpack.config||{},nvpack.config.p)return!1;nvpack.config.p=!0,this.config.urls=w,this.data.auth=this.response.auth||{},this.data.setting=this.response.auth||{},this.data.auth.ruleData&&(this.data.setting.ruleData=this.data.auth.ruleData=this.response.ruleData),this.response.tokens&&(this.data.setting.tokens=this.data.auth.tokens=this.response.tokens),this.data.setting.trafficSource=this.data.auth.trafficSource=document.referrer,this.data.setting.pageUrl=this.data.auth.pageUrl=document.location,this.data.setting.gmOffset=this.data.auth.gmOffset=60*b.getTimezoneOffset()*-1,this.data.setting.incognito=this.browserController.isIncognito,this.data.setting.screenWidth=this.data.auth.screenWidth=screen.width,this.data.setting.screenHeight=this.data.auth.screenHeight=screen.height,this.messageListener(),this.load()}},{key:"load",value:function(){if("fail"==this.response.Authentication)return!1;this.browserController.getBrowser(),window.notify_visitors.po=window.notify_visitors.po||{},window.notify_visitors.po.pushConfirmTMessage=this.widgetContoller.pushConfirmTMessage,window.notify_visitors.po.updateUserIdSubscription=this.updateUserIdSubscription.bind(this),!1===(window!==window.parent)&&(""!=this.response.cookie_domain&&(this.data.cookie_domain=this.response.cookie_domain),this.config.addToHomeSetting=this.response.add_to_home_details?this.response.add_to_home_details:{},this.config.pushDetails=this.response.pushDetails?this.response.pushDetails:{},this.config.pushLabel=!!this.response.white_label&&this.response.white_label,(this.response.pushDetails||this.response.add_to_home_details)&&this.pushHandlerController.pushHandler(),this.response.add_to_home_details&&1==this.response.add_to_home_details.allow&&document.location.href.indexOf("webapp=1")>1&&this.addToHSsession(),this.athsMessageListener())}},{key:"addToHSsession",value:function(){window.sessionStorage.getItem("nv_web_app_session")||(window.sessionStorage.setItem("nv_web_app_session",function(){function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()}()),this.sendStats("web_app_opened"))}},{key:"updateUserIdSubscription",value:function(i){if(i&&this.cookieController.get("nv_push_subscribe")){var n=this.cookieController.get("nv_push_subscribe"),t=Object.assign({},this.data.auth),e=void 0;this.browserController.browserStatus.isChrome&&1==this.response.pushDetails.chrome?(e=this.config.urls.chrome_subscribe,t.subscriptionId=n):this.browserController.browserStatus.isFirefox&&1==this.response.pushDetails.mozilla?(e=this.config.urls.mozilla_subscribe,t.endpoint=endpoint):this.browserController.browserStatus.isSafari&&1==this.response.pushDetails.safari&&(e=this.config.urls.safari_subscribe,t.subscriptionId=n),t.userID=i,e&&this.getJSONP.get(e,t,this.callbackName,this.handleUpdateUserResponse.bind(this))}}},{key:"handleUpdateUserResponse",value:function(i){}},{key:"addToHSListner",value:function(n){var t=this;void 0!=t.config.addToHomeSetting&&(1==t.config.addToHomeSetting.allow?0==t.config.addToHomeSetting.aths_type?t.beforeInstallPromptHandler(n):1==t.config.addToHomeSetting.aths_type&&t.config.addToHomeSetting.aths_btnID&&(t.addToHomeBtn=document.getElementById(t.config.addToHomeSetting.aths_btnID),t.addToHomeBtn?(i=t.addToHomeBtn,t.addToHomeBtn.addEventListener("click",t.addToHomeBtnClickHandler),t.beforeInstallPromptHandlerDiffer(n)):console.log("Error:: no button found")):console.log("add to home inactive"))}},{key:"beforeInstallPromptHandlerDiffer",value:function(i){this.beforeInstallPromptEvent=i,this.addToHomeBtn.style.display="block",i.preventDefault()}},{key:"beforeInstallPromptHandler",value:function(n){var t=this;0==this.webappShown&&(this.webappShown=1,this.sendStats("web_app_shown")),window.addEventListener("appinstalled",function(n){i&&(i.style.display="none"),t.sendStats("web_app_installed");try{nv("event","web_app_install","",1,1)}catch(i){console.log(i)}}),n.userChoice.then(function(i){"dismissed"==i.outcome?this.sendStats("web_app_canceled"):(this.sendStats("web_app_installed"),this.beforeInstallPromptEvent=null)}.bind(this)).catch(function(i){console.log(i)})}},{key:"addToHomeBtnClickHandler",value:function(i){this.beforeInstallPromptEvent?(this.beforeInstallPromptEvent.prompt(),this.beforeInstallPromptHandler(this.beforeInstallPromptEvent)):console.log("no event found please add to home screen via chrome menu")}},{key:"messageListener",value:function(){var i=this;window.addEventListener("message",function(t){try{var e=JSON.parse(t.data);if(e&&"object"===(void 0===e?"undefined":n(e))&&void 0!=e[0])switch(e[0]){case"nv_push":if("subscribe"==e[1]){var o="200"==e[2]?e[3]:"";i.handlepushSubscription(e[2],o)}break;case"nvpush_nc_confirm":i.widgetContoller.pushConfirmPositive();break;case"nv_centerHeight":!function(i){var n=document.getElementById("nv-center-iframe-wrapper");if(n){var t=350;t=i.height<350?Math.min(i.height+13,window.innerHeight-20):t,n.style.height=t+"px",n.style.transition="all 0.3s ease-in"}}(e[1])}}catch(i){}},!1)}},{key:"athsMessageListener",value:function(){var i=this;window.addEventListener("beforeinstallprompt",function(n){if(void 0==i.config.addToHomeSetting||1!=i.config.addToHomeSetting.allow)return n.preventDefault(),!1;i.addToHSListner(n)})}},{key:"sendStats",value:function(i){this.config.pushWindowClose=1,i&&(this.gapush.send("NotifyVisitors","Push_Stats",i),this.config.pushStats={},this.config.pushStats=Object.assign({},this.data.auth),this.config.pushStats.action=i,this.getJSONP.get(this.config.urls.push_stats,this.config.pushStats,this.callbackName,this.handleStatsResponse.bind(this)))}},{key:"handleStatsResponse",value:function(i){this.config.pushWindowClose=0}},{key:"handlepushSubscription",value:function(i,n){var t=this;switch(i){case"202":t.cookieController.set("nv_push_neg",1);break;default:if(t.cookieController.set("nv_push_error",i,"Fri, 31 Dec 9999 23:59:59 GMT"),"200"==i){var e="Fri, 31 Dec 9999 23:59:59 GMT";if(t.browserController.browserStatus.isFirefox){var o=new Date;o.setTime(o.getTime()+1728e6),e=o.toGMTString()}t.cookieController.set("nv_push_subscribe",n,e),t.pushLeaveIntentController.initialize(n);var s=t.config.pushsubscribe&&t.scope.config.pushsubscribe.event?t.scope.config.pushsubscribe.event:{};nv("event","Push Subscription",s,1,3)}}if(null!=window.opener&&-1!=location.href.indexOf("nv_url")){var r=JSON.stringify(["nv_push","subscribe",i,n]);window.opener.postMessage(r,document.referrer),setInterval(function(){t.config.pushWindowClose||self.close()},1e3)}}}]),_}();return new k(window.notify_visitors.Push.data),k}();
